<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Why is Zoom help page broken? A router IPv6 bug - vpereira01</title><meta name=Description content="vpereira01 site"><meta property="og:url" content="https://vpereira01.com/posts/zoom-ipv6-router-bug/">
<meta property="og:site_name" content="vpereira01"><meta property="og:title" content="Why is Zoom help page broken? A router IPv6 bug"><meta property="og:description" content="Trying to enable Zoom blur background in Linux I end up several times on the Zoom Virtual Background system requirements page which was always broken, as in, clicking on the Linux section did not expand to show the relevant information. It was annoying but I could reach the relevant information using the Firefox Web Developer Tools. Nonetheless, it was bothering that it was always broken and if it was broken for everybody Zoom people would already handled it."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-21T10:48:54+01:00"><meta property="article:modified_time" content="2022-05-21T10:48:54+01:00"><meta property="article:tag" content="Troubleshoot"><meta property="article:tag" content="Ipv6"><meta name=twitter:card content="summary"><meta name=twitter:title content="Why is Zoom help page broken? A router IPv6 bug"><meta name=twitter:description content="Trying to enable Zoom blur background in Linux I end up several times on the Zoom Virtual Background system requirements page which was always broken, as in, clicking on the Linux section did not expand to show the relevant information. It was annoying but I could reach the relevant information using the Firefox Web Developer Tools. Nonetheless, it was bothering that it was always broken and if it was broken for everybody Zoom people would already handled it."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://vpereira01.com/posts/zoom-ipv6-router-bug/><link rel=prev href=https://vpereira01.com/posts/go-bigint-perf/><link rel=next href=https://vpereira01.com/posts/chatgpt-pt-power-outage/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Why is Zoom help page broken? A router IPv6 bug","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/vpereira01.com\/posts\/zoom-ipv6-router-bug\/"},"genre":"posts","keywords":"troubleshoot, ipv6","wordcount":1116,"url":"https:\/\/vpereira01.com\/posts\/zoom-ipv6-router-bug\/","datePublished":"2022-05-21T10:48:54+01:00","dateModified":"2022-05-21T10:48:54+01:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"vpereira01"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=vpereira01>vpereira01</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=vpereira01>vpereira01</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Why is Zoom help page broken? A router IPv6 bug</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/about title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>vpereira01</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-05-21>2022-05-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1116 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#first-troubleshoots-and-hypothesis>First troubleshoots and hypothesis</a></li><li><a href=#second-hypothesis-something-is-broken-in-my-isp>Second hypothesis, something is broken in my ISP</a></li><li><a href=#third-hypothesis-something-is-broken-with-my-router>Third hypothesis, something is broken with my router</a><ul><li></li></ul></li><li><a href=#afterthoughts>Afterthoughts</a></li></ul></nav></div></div><div class=content id=content><p>Trying to enable Zoom blur background in Linux I end up several times on the <a href=https://support.zoom.us/hc/en-us/articles/360043484511 target=_blank rel="noopener noreffer">Zoom Virtual Background system requirements</a> page which was always broken, as in, clicking on the Linux section did not expand to show the relevant information. It was annoying but I could reach the relevant information using the Firefox Web Developer Tools.
Nonetheless, it was bothering that it was always broken and if it was broken for everybody Zoom people would already handled it.</p><h2 id=first-troubleshoots-and-hypothesis>First troubleshoots and hypothesis</h2><p>Checking Firefox Web Developer Tools console it was very likely the issue was caused by a failure to get JQuery library as JQuery is used a lot for these kind of interactions, i.e. click to expand. As it is a good practice, the first steps I took was to do simple variations to quickly eliminate hypotheses and hopefully find some commonality to the issue.</p><p>In this case, the first things I wanted to vary were:</p><ul><li>The browser, since some sites don&rsquo;t play well with Firefox and/or the extensions I use;</li><li>The DNS resolver, since some sites/CDNs/services expect people to use the default ISP DNS resolver to work properly/optimally;</li><li>IPv6 enabled/disabled, because I have already seen some issues like slower speeds with IPv6;</li><li>The operating system, for the sake of eliminating the possibility that my Linux distribution is a factor.</li></ul><p>After testing these variations, at my home network, surprisingly the issue was related to IPv6.</p><p><strong>Hypothesis 01</strong> The server/CDN serving JQuery has some issues handling IPv6 requests.</p><p>The JQuery library was being served from <a href=https://code.jquery.com/ target=_blank rel="noopener noreffer">https://code.jquery.com/</a> and searching around I quickly found a few GitHub issues related to IPv6 so this hypothesis seemed solid. The last GitHub issue <a href=https://github.com/jquery/codeorigin.jquery.com/issues/82 target=_blank rel="noopener noreffer">codeorigin.jquery.com/82</a> was still open so I just added information that I also had a similar issue.</p><p>Unfortunately, the feedback from the issue indicated there was nothing wrong with serving JQuery specifically.</p><h2 id=second-hypothesis-something-is-broken-in-my-isp>Second hypothesis, something is broken in my ISP</h2><p>Discussing the issue on GitHub and doing further tests new information was obtained:</p><ul><li>Not all requests with <code>curl</code> and IPv6 failed, around 1 in 7 were successful;</li><li>Testing other URLs hosted on the same CDN provider showed the same behaviour.</li></ul><p>This had me suggest that something might be wrong with CDN provider handling of TLS connections, given the <code>curl</code> logs information, because I know CDNs usually have some kind of custom TLS connection termination. Still it lead me to a new hypothesis:</p><p><strong>Hypothesis 02</strong> Something is wrong with my ISP IPv6 handling.</p><p>With this hypothesis and knowing that the next step in the troubleshoot would require sending a packet capture to the CDN support, which I didn&rsquo;t had a way to do it privately and/or knew a way to share publicly without exposing private information, I decide to investigate this hypothesis.</p><p>I went to some local tech communities&rsquo; chats and asked around. Initially I got some kind of confirmation as a guy remembered having similar IPv6 issues with Python PIP packages and ISP support could not figure out the issue. Still this hypothesis was quickly destroyed as other people, with the same ISP and IPv6, could make the requests with no issues.</p><p>I had the time, and was still trying to avoid sending a packet capture, so I started searching for IPv6 issues and somehow hit the jackpot, I found the GitHub issue <a href=https://github.com/pypa/pip/issues/5374 target=_blank rel="noopener noreffer">pip/5374</a> that mentioned Python PIP packages, IPv6, my ISP and my router :)</p><h2 id=third-hypothesis-something-is-broken-with-my-router>Third hypothesis, something is broken with my router</h2><p>According to the pip issue my router has a bug which changes, during TCP connection, the IPv6 Flow Label which breaks some load balancing algorithms and thus the connection is dropped. The information was useful but the solutions found required disabling IPv6 or getting a new router which were not that satisfying and I really wanted to fully confirm this hypothesis.</p><h6 id=what-the-hell-is-ipv6-flow-label>What the hell is IPv6 Flow Label?</h6><p>As far as I know, because I&rsquo;m not a network expert, IPv4 is a more pure datagram protocol since an IPv4 packet header does not contain information about if a packet belongs to any TCP/UDP connection/stream. Furthermore a router inspecting IPv4 packet headers coming from the same source and to the same destination can not easily infer if the source/destination are maintaining zero or many TCP connections. IPv6 seems to deviate from this as it contains the IPv6 Flow Label header field in each &ldquo;flow&rdquo; of packets (TCP connection/UDP stream) is labeled. Even ICMP pings seem to be labeled.</p><p>The rules for this labeling seem to have evolved over time but the current standard as I understand it is:</p><ul><li>When a network socket is open, the OS, attributes a Flow Label which is used on all packets sent;</li><li>The Flow Label can be determined by (source, destination) or (source, destination, protocol, source port, destination port).</li></ul><p>The goal for IPv6 Flow Labels seems to reduce the computation costs of load balancing by reducing the need to inspect transmission protocols headers (TCP,UDP,etc.) as IPv6 headers suffice.</p><p>If you want to dig around further I suggest starting with this:</p><ul><li><a href=https://github.com/marian-babik/ipv6_flow_label target=_blank rel="noopener noreffer">https://github.com/marian-babik/ipv6_flow_label</a></li><li><a href=https://blog.apnic.net/2018/01/11/ipv6-flow-label-misuse-hashing/ target=_blank rel="noopener noreffer">https://blog.apnic.net/2018/01/11/ipv6-flow-label-misuse-hashing/</a></li></ul><h6 id=testing-hypothesis>Testing hypothesis</h6><p>Knowing all this I lurked around kernel parameters to see if there was an easy way to disable IPv6 Flow Labels, as in, always set them to zero. I expected that my router would not assign a Flow Label if there was none present.</p><p>Searching around I found that on <a href=https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt target=_blank rel="noopener noreffer">ip-sysctl.txt</a> which contains the promising parameter <code>auto_flowlabels</code> which could pretty much disable all IPv6 Flow Labels.</p><p>Now this was seem an easy test to make :)</p><script src=https://gist.github.com/vpereira01/71caee5d418a4106a6e5bccd6dfd9de5.js></script><h6 id=fixing-the-issue>Fixing the issue</h6><p>After the issue was confirmed I decide to not immediately ask my ISP for a router fix/replacement. Some CDN providers have improved their compatibility with non-standard use of IPv6 and I would need this broken router to confirm a fix. So I reported my finds while also understanding if they would not try to change their infrastructure for a router behaviour that probably affects very few people.</p><p>Not only the issue was fixed quickly as they expressed gratitude in the information provided :)</p><h2 id=afterthoughts>Afterthoughts</h2><p>First I would like express gratitude to</p><ul><li>JQuery folks for the support and having a public place to discuss issues;</li><li>Highwinds/StackPath folks for fixing the issue and being so nice;</li><li>Pip folks for doing the initial investigation and finding the root cause of the issue;</li><li>Joel from Fastly for publicly writing about the IPv6 Flow Label.</li></ul><p>If someone wants to dig further, a question that was left hanging was why didn&rsquo;t Firefox and Chrome fallback to IPv4 worked. Both seem to implement the &ldquo;Happy Eyeballs&rdquo; algorithm, which is at a glance, should have kicked in and hidden the IPv6 issue.</p><p>Anyway, now I can restart trying/whishing to have blurred backgrounds in Zoom with Linux.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-05-21</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://vpereira01.com/posts/zoom-ipv6-router-bug/ data-title="Why is Zoom help page broken? A router IPv6 bug" data-hashtags=troubleshoot,ipv6><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://vpereira01.com/posts/zoom-ipv6-router-bug/ data-hashtag=troubleshoot><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://vpereira01.com/posts/zoom-ipv6-router-bug/ data-title="Why is Zoom help page broken? A router IPv6 bug"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://vpereira01.com/posts/zoom-ipv6-router-bug/ data-title="Why is Zoom help page broken? A router IPv6 bug"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://vpereira01.com/posts/zoom-ipv6-router-bug/ data-title="Why is Zoom help page broken? A router IPv6 bug"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/troubleshoot/>Troubleshoot</a>,&nbsp;<a href=/tags/ipv6/>Ipv6</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/go-bigint-perf/ class=prev rel=prev title="Go big.Int add one performance curiosity"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Go big.Int add one performance curiosity</a>
<a href=/posts/chatgpt-pt-power-outage/ class=next rel=next title="Creating a simple website using ChatGPT">Creating a simple website using ChatGPT<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/about target=_blank>vpereira01</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>